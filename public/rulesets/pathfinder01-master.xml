<?xml version="1.0" encoding="UTF-8"?>
<RuleSet name="pf" title="Pathfinder" description="Pathfinder Roleplaying Game">
	<Modules>
		<Module type="stats" src="pf-stat-module01.js" />
		<Module type="pages" src="pf-page-module01.js" />
	</Modules>
	<Formulae>
		<Formula name="convert_modifier_to_string" type="Str">
			<If inType="Int" outType="Str">
				<Compare fromId="this" attribute="modifier" />
				<GreaterThan value="-1" />
				<Then fromId="this" attribute="modifier" prepend="+" />
				<Else fromId="this" attribute="modifier" />
			</If>
		</Formula>
		<Formula name="convert_modified_value_to_string" type="Str">
			<If inType="Int" outType="Str">
				<Compare fromId="this" attribute="modifiedValue" />
				<GreaterThan value="-1" />
				<Then fromId="this" attribute="value" prepend="+" />
				<Else fromId="this" attribute="value" />
			</If>
		</Formula>
		<Formula name="odd_levels" type="Int">
			<Math>
				<Add fromId="Level" />
				<Add value="1" />
				<Divide value="2" />
				<Floor />
			</Math>
		</Formula>
		<Formula name="half_level" type="Int">
			<Math>
				<Add fromId="Level" />
				<Divide value="2" />
				<Floor />
			</Math>
		</Formula>
	</Formulae>
	<Stats>
		<Group id="ability_scores" userEditable="true" type="IntBonusable" startingValue="0" minValue="0" maxValue="99">
			<Stat id="STR" title="Strength" />
			<Stat id="DEX" title="Dexterity" />
			<Stat id="CON" title="Constitution" />
			<Stat id="INT" title="Intelligence" />
			<Stat id="WIS" title="Wisdom" />
			<Stat id="CHA" title="Charisma" />
			<Attribute name="modifier" userEditable="false" minValue="-99">
				<Math>
					<Add fromId="this" attribute="modifiedValue" />
					<Add value="-10" />
					<Divide value="2" />
					<Floor />
				</Math>
			</Attribute>
			<Attribute name="modifierNonNegative" userEditable="false" minValue="-99">
				<If inType="Int" outType="Int">
					<Compare fromId="this" attribute="modifier" />
					<NotLessThan value="0" />
					<Then fromId="this" attribute="modifier" />
					<Else value="0" />
				</If>
			</Attribute>
			<Attribute name="modifierPositive" userEditable="false" minValue="-99">
				<If inType="Int" outType="Int">
					<Compare fromId="this" attribute="modifier" />
					<GreaterThan value="0" />
					<Then fromId="this" attribute="modifier" />
					<Else value="1" />
				</If>
			</Attribute>
			<Attribute name="modifier_text" type="Str" userEditable="false" formula="convert_modifier_to_string" />
		</Group>
		<Stat id="Level" title="Level" type="Int" startingValue="1" minValue="1">
			<Attribute name="goodSave">
				<Math>
					<Add fromId="this" />
					<Divide value="2" />
					<Add value="2" />
					<Floor />
				</Math>
			</Attribute>
			<Attribute name="badSave">
				<Math>
					<Add fromId="this" />
					<Divide value="3" />
					<Floor />
				</Math>
			</Attribute>
		</Stat>
		<Stat id="Init" title="Initiative" type="IntBonusable" startingValue="0" minValue="-99">
			<Attribute name="modifier_text" formula="convert_modified_value_to_string" />
		</Stat>
		<Stat id="Feats" type="IntBonusable" title="Feats" minValue="0" startingValue="0">
			<Bonus formula="odd_levels" />
		</Stat>
		<Stat id="SkillPoints" type="IntBonusable" title="Skill Points" minValue="0" />
		<Group id="skills" type="PfSkill">
			<Group id="strength_skill">
				<Stat id="Climb" title="Climb" />
				<Stat id="Swim" title="Swim" />
				<Attribute name="score_mod" minValue="-99" getFromId="STR" attribute="modifier" />
			</Group>
			<Group id="dexterity_skill">
				<Stat id="Acrobatics" title="Acrobatics" />
				<Stat id="Disable Device" title="Disable Device" />
				<Stat id="Escape Artist" title="Escape Artist" />
				<Stat id="Fly" title="Fly">
					<Bonus getFromId="size" attribute="flySkillModifier" />
				</Stat>
				<Stat id="Ride" title="Ride" />
				<Stat id="Sleight of Hand" title="Sleight of Hand" background="1" />
				<Stat id="Stealth" title="Stealth">
					<Bonus getFromId="size" attribute="stealthSkillModifier" />
				</Stat>
				<Attribute name="score_mod" minValue="-99" getFromId="DEX" attribute="modifier" />
			</Group>
			<Group id="intelligence_skill">
				<Stat id="Appraise" title="Appraise" background="1" />
				<Stat id="Knowledge (arcana)" title="Knowledge (arcana)" />
				<Stat id="Knowledge (dungeoneering)" title="Knowledge (dungeoneering)" />
				<Stat id="Knowledge (engineering)" title="Knowledge (engineering)" background="1" />
				<Stat id="Knowledge (geography)" title="Knowledge (geography)" background="1" />
				<Stat id="Knowledge (history)" title="Knowledge (history)" background="1" />
				<Stat id="Knowledge (local)" title="Knowledge (local)" />
				<Stat id="Knowledge (nature)" title="Knowledge (nature)" />
				<Stat id="Knowledge (nobility)" title="Knowledge (nobility)" background="1" />
				<Stat id="Knowledge (planes)" title="Knowledge (planes)" />
				<Stat id="Knowledge (religion)" title="Knowledge (religion)" />
				<Stat id="Linguistics" title="Linguistics" background="1">
					<Attribute name="half_negative">
						<Math>
							<Subtract fromID="this" />
							<Divide value="2" />
							<Floor />
						</Math>
					</Attribute>
				</Stat>
				<Stat id="Spellcraft" title="Spellcraft" />
				<MultiStat id="craft_skills" idPre="Craft (" idPost=")" titlePre="Craft (" titlePost=")" background="1" />
				<Attribute name="score_mod" minValue="-99" getFromId="INT" attribute="modifier" />
			</Group>
			<Group id="wisdom_skill">
				<Stat id="Heal" title="Heal" />
				<Stat id="Perception" title="Perception" />
				<Stat id="Sense Motive" title="Sense Motive" />
				<Stat id="Survival" title="Survival" />
				<MultiStat id="profession_skills" idPre="Profession (" idPost=")" titlePre="Profession (" titlePost=")" background="1" />
				<Attribute name="score_mod" minValue="-99" getFromId="WIS" attribute="modifier" />
			</Group>
			<Group id="charisma_skill">
				<Stat id="Bluff" title="Bluff" />
				<Stat id="Diplomacy" title="Diplomacy" />
				<Stat id="Disguise" title="Disguise" />
				<Stat id="Handle Animal" title="Handle Animal" background="1" />
				<Stat id="Intimidate" title="Intimidate" />
				<Stat id="Use Magic Device" title="Use Magic Device" />
				<MultiStat id="perform_skills" idPre="Perform (" idPost=")" titlePre="Perform (" titlePost=")" background="1" />
				<Attribute name="score_mod" minValue="-99" getFromId="CHA" attribute="modifier" />
			</Group>
			<Attribute name="modifier" minValue="-99">
				<Math>
					<Add fromId="this" attribute="modifiedValue" />
					<Add fromId="this" attribute="score_mod" />
				</Math>
			</Attribute>
			<Attribute name="modifier_text" type="Str" formula="convert_modifier_to_string" />
		</Group>
		<Group id="saving_throws" type="IntBonusable" minValue="-99" maxValue="99" startingValue="0">
			<Stat id="FortSave" title="Fortitude">
				<Attribute name="score_mod" getFromId="CON" attribute="modifier" />
			</Stat>
			<Stat id="ReflSave" title="Reflex">
				<Attribute name="score_mod" getFromId="DEX" attribute="modifier" />
			</Stat>
			<Stat id="WillSave" title="Will">
				<Attribute name="score_mod" getFromId="WIS" attribute="modifier" />
			</Stat>
			<Attribute name="modifier" minValue="-99">
				<Math>
					<Add fromId="this" attribute="value" />
					<Add fromId="this" attribute="score_mod" />
				</Math>
			</Attribute>
			<Attribute name="modifier_text" type="Str" formula="convert_modifier_to_string" />
		</Group>
		<Stat id="BAB" type="IntBonusable" title="Base Attack Bonus" startingValue="0">
			<Attribute name="full_attack_text">
				<While inType="Int" outType="Str">
					<Until operation="AND">
						<GreaterThan value="5" />
					</Until>
					<Input fromId="this" attribute="value" />
					<Output fromId="this" attribute="modifier_text" />
					<ModifyInput add="-5" />
					<ModifyOutput add="/+" useInput="add" />
				</While>
			</Attribute>
			<Attribute name="modifier_text" type="Str" formula="convert_modified_value_to_string" />
		</Stat>
		<Group id="speeds" type="IntBonusable" stepValue="5" startingValue="0">
			<Stat id="landSpeed" title="Speed" />
			<Stat id="flySpeed" title="Fly Speed" />
			<Stat id="climbSpeed" title="Climb Speed" />
			<Stat id="swimSpeed" title="Swim Speed" />
			<Stat id="burrowSpeed" title="Burrow Speed" />
		</Group>
		<Stat id="darkvision" type="IntBonusable" title="Darkvision" startingValue="0" />
		<Stat id="lowLightVision" type="TF" title="Low-Light Vision" startingValue="0" />
		<Stat id="size" type="PfSize" title="Size" startingValue="4" />
		<Stat id="creatureType" type="Str" startingValue="humanoid" />
		<Stat id="characterName" type="Str" startingValue="Bob" />
<!--		<Stat id="" type="IntBonusable" title="" startingValue="0" />
		<Stat id="" type="IntBonusable" title="" startingValue="0" />
		<Stat id="" type="IntBonusable" title="" startingValue="0" />-->
		<Stat id="languagesKnown" type="IntBonusable" title="Languages Known" startingValue="1">
			<Bonus getFromId="INT" attribute="modifierNonNegative" />
			<Bonus getFromId="Linguistics" />
		</Stat>
		<Stat id="naturalArmor" type="IntBonusable" startingValue="0" />
		<Stat id="dodgeBonus" type="IntBonusable" startingValue="0" />
		<Stat id="delectionBonus" type="IntBonusable" startingValue="0" />
		<Stat id="armorBonus" type="IntBonusable" startingValue="0" />
		<Stat id="shieldBonus" type="IntBonusable" startingValue="0" />
		<Stat id="hardACBonuses" type="IntBonusable" startingValue="0">
			<Bonus getFromId="naturalArmor" type="natural armor" />
			<Bonus getFromId="armorBonus" type="armor" />
			<Bonus getFromId="shieldBonus" type="shield" />
		</Stat>
		<Stat id="universalACBonuses" type="IntBonusable" startingValue="0">
			<Bonus getFromId="deflectionBonus" type="deflection" />
		</Stat>
		<Stat id="AC" type="IntBonusable" title="AC" startingValue="10">
			<Bonus getFromId="DEX" attribute="modifier" />
			<Bonus getFromId="size" attribute="sizeModifier" type="size" />
			<Bonus getFromId="dodgeBonus" type="dodge" />
			<Bonus getFromId="hardACBonuses" attribute="modifiedValue" />
			<Bonus getFromId="universalACBonuses" attribute="modifiedValue" />
		</Stat>
		<Stat id="TAC" type="IntBonusable" title="Touch AC" startingValue="10">
			<Bonus getFromId="DEX" attribute="modifier" />
			<Bonus getFromId="dodgeBonus" type="dodge" />
			<Bonus getFromId="size" attribute="sizeModifier" type="size" />
			<Bonus getFromId="universalACBonuses" attribute="modifiedValue" />
		</Stat>
		<Stat id="FFAC" type="IntBonusable" title="Flat-footed AC" startingValue="10">
			<Bonus getFromId="DEX" attribute="modifierNonPositive" />
			<Bonus getFromId="size" attribute="sizeModifier" type="size" />
			<Bonus getFromId="hardACBonuses" attribute="modifiedValue" />
			<Bonus getFromId="universalACBonuses" attribute="modifiedValue" />
		</Stat>
		<Stat id="CMB" type="IntBonusable" title="CMB" startingValue="0">
			<Attribute name="statBonus" type="Int">
				<If inType="Int" outType="Int">
					<Compare fromId="size" />
					<LessThan value="3" />
					<Then fromId="DEX" attribute="modifier" />
					<Else fromId="STR" attribute="modifier" />
				</If>
			</Attribute>
			<Bonus getFromId="this" attribute="statBonus" />
			<Bonus getFromId="BAB" attribute="modifiedValue" />
			<Bonus getFromId="size" attribute="specialSizeModifier" type="size" />
		</Stat>
		<Stat id="CMD" type="IntBonusable" title="CMD" startingValue="10">
			<Bonus getFromId="STR" attribute="modifier" />
			<Bonus getFromId="DEX" attribute="modifier" />
			<Bonus getFromId="BAB" attribute="modifiedValue" />
			<Bonus getFromId="universalACBonuses" attribute="modifiedValue" />
			<Bonus getFromId="size" attribute="specialSizeModifier" type="size" />
			<Bonus getFromId="dodgeBonus" type="dodge" />
		</Stat>
		<Stat id="CMDFF" type="IntBonusable" title="Flat-footed CMD" startingValue="10">
			<Bonus getFromId="STR" attribute="modifier" />
			<Bonus getFromId="DEX" attribute="modifierNonPositive" />
			<Bonus getFromId="BAB" attribute="modifiedValue" />
			<Bonus getFromId="universalACBonuses" attribute="modifiedValue" />
			<Bonus getFromId="size" attribute="specialSizeModifier" type="size" />
		</Stat>
		<Stat id="SR" title="Spell Resistance" type="IntBonusable" startingValue="0" />
		<Stat id="AcidResist" title="Acid Resistance" type="IntBonusable" startingValue="0" />
		<Stat id="ColdResist" title="Cold Resistance" type="IntBonusable" startingValue="0" />
		<Stat id="ElecResist" title="Electricity Resistance" type="IntBonusable" startingValue="0" />
		<Stat id="FireResist" title="Fire Resistance" type="IntBonusable" startingValue="0" />
		<Group id="string_pools" type="Str" separator=",">
			<Pool id="languages" title="Languages" fromCategory="languages" value="Common,Elven,Dwarven,Gnomish,Halfling,Celestial,Infernal,Abyssal,Draconic,Sylvan,Aquan,Terran,Ignan,Auran,Undercommon,Gnoll,Goblin,Giant,Orc,Aboleth,Aklo,Boggard,Cyclops,Dark Folk,D'ziriak,Drow Sign Language,Grippli,Necril,Protean,Sphinx,Tengu,Treant,Vegepygmy,Read Lips">
				<Attribute name="maxSelectable" type="Int" fromId="languagesKnown" />
			</Pool>
			<Pool id="bonusLanguages" title="Bonus Language Choices" />
			<Pool id="creatureSubtypes" title="Creature Subtypes" />
			<Pool id="weaponProficiencies" title="Weapon Proficiencies" />
			<Pool id="weaponMartial" />
			<Pool id="favoredClassChoices" title="Favored Class Choices" value="bard,barbarian,cleric,druid,fighter,monk,paladin,ranger,rogue,unchRogue,sorcerer,wizard,alchemist,cavalier,gunslinger,inquisitor,magus,oracle,summoner,witch,samurai,hunter,warpriest,bloodrager,shaman,skald,slayer,swashbuckler,shifter,investigator" />
		</Group>
		<Stat id="favoredClasses" type="IntBonusable" startingValue="1" />
		<Group id="string_pools_with_commas" type="Str" separator="%%%">
			<Pool id="HIDDEN VARIABLES" />
			<Pool id="skillEffects" title="Skill Effects" />
			<Pool id="saveEffects" title="Saving Throw Effects" />
			<Pool id="combatEffects" title="Combat Effects" />
			<Pool id="spellcastingEffects" title="Spellcasting Effects" />
			<Pool id="speedEffects" title="Movement Effects" />
			<Pool id="miscEffects" title="Skill Effects" />
		</Group>
		<Stat id="spellLikeAbilities" type="PfSpells" title="Spell-Like Abilities" />
		<Stat id="spellsKnown" type="PfSpells" title="Spells Known" />
		<Stat id="concentrationCheckBase" type="IntBonusable" startingValue="0" />
	</Stats>
	<Bundles>
		<Bundle category="race" src="pf/pathfinder01-races.xml" />
		<Bundle category="class" src="pf/pathfinder01-classes.xml" />
	</Bundles>
	<Choices>
		<Group category="race">
			<Choice id="human" title="Human" />
			<Choice id="elf" title="Elf" />
			<Choice id="halfElf" title="Half-Elf" />
			<Choice id="halfOrc" title="Half-Orc" />
			<Choice id="dwarf" title="Dwarf" />
			<Choice id="gnome" title="Gnome" />
			<Choice id="halfling" title="Halfling" />
		</Group>
		<Group category="languages">
		</Group>
	</Choices>
	<Pages>
		<Page id="BEGIN" class="flex-vertical"> <!-- should this be a template? -->
			<Block>
				<ol>
					<li><label>Name: <INPUT id="characterName" /></label></li>
					<li>Stats:<ul>
						<li><label><INPUT id="STR" /> Strength</label></li>
						<li><label><INPUT id="DEX" /> Dexterity</label></li>
						<li><label><INPUT id="CON" /> Constitution</label></li>
						<li><label><INPUT id="INT" /> Intelligence</label></li>
						<li><label><INPUT id="WIS" /> Wisdom</label></li>
						<li><label><INPUT id="CHA" /> Charisma</label></li>
					</ul></li>
					<li><label>Choose a race: <CHOOSE category="race" /></label></li>
				</ol>
				<BUTTON to="page2">Continue</BUTTON>
			</Block>
		</Page>
		<Page id="page2" class="flex-vertical">
			<Block template="PfRacialTraits" contents="append"> <!-- how are values transmitted from page to page? -->
				<BUTTON to="page3">Continue</BUTTON>
			</Block>
		</Page>
		<Page id="page3" class="flex-vertical">
			<Block>
				<Block template="PfStats" />
				<ol start="4">
					<li><label>Choose a class: <CHOOSE category="classes" /></label></li>
				</ol>
				<BUTTON to="page4">Continue</BUTTON>
			</Block>
		</Page>
		<Page id="page4" class="flex-vertical">
			<Block template="PfClassArchetypes" contents="append">
				<BUTTON to="page5">Continue</BUTTON>
			</Block>
		</Page>
		<Page id="page5" class="flex-vertical">
			<Block template="PfClassChoices" contents="append">
				<BUTTON to="page6">Continue</BUTTON>
			</Block>
		</Page>
		<Page id="page6" class="flex-vertical">
			<ol start="5">
				<li>Skill Ranks</li>
			</ol>
			<Block template="PfSkillsAdjust" />
			<BUTTON to="page7">Continue</BUTTON>
		</Page>
	</Pages>
</RuleSet>
